<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pagar con Daviplata</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="container-fluid">
    <div class="row">
      <div class="col-12 col-md-6 my-4">
        <header class="text-center text-md-start">
          <img width="240" src="../assets/images/logo-daviplata.svg" alt="Logo Daviplata" class="pe-md-5 w-50" height="100">
        </header>
        <p class="fw-bold text-center text-md-start">Por favor digita tus datos</p>
        <form  class="needs-validation" action="" novalidate>
          <div class="d-flex flex-column combo-fields">
            <div class="form-floating">
              <select onChange="obtenerTipoDocumento()" class="form-select" id="documentType" aria-label="Selector de Tipo de Documento">
                <option value="CC" selected>Cédula de Ciudadanía</option>
                <option value="CE">Cédula de Extranjería</option>
                <option value="TI">Tarjeta de Identidad</option>
              </select>
              <label for="documentType">Tipo de documento</label>
            </div>
            <div class="form-floating">
              <input required type="number" class="form-control" id="documentNumber" placeholder="Número de documento">
              <div class="invalid-feedback">
                Por favor, ingresa un número válido de <span id="selectedValue"></span>
              </div>
              <label for="documentNumber">Número de documento</label>
            </div>
          </div>
          <div class="d-flex flex-column gap-3">
            <button class="col btn btn-daviplata text-white" type="submit">Continuar</button>
            <button id="btnCancelar" name="Cancelar pago con Daviplata" class="col btn btn-outline-secondary" type="button" role="button">Cancelar</button>
          </div>
        </form>
      </div>
      <div class="col-12 col-md-6 my-4">
        <div class="resumen-pago orden-compra">
          <div class="list-group">
            <div class="list-group-item list-group-item-action">
              <h6 class="mb-1">Número de solicitud</h6>
              <p class="mb-1">20204462</p>
            </div>
            <div class="list-group-item list-group-item-action">
              <h6 class="mb-1">Estado de solicitud</h6>
              <p class="mb-1"><span class="badge text-bg-warning" id="estadoProceso">En Proceso</span></p>
            </div>
            <div class="list-group-item list-group-item-action">
              <h6 class="mb-1">Fecha de generación</h6>
              <p class="mb-1">Jueves 6 de julio, 2023</p>
            </div>
            <div class="list-group-item list-group-item-action">
              <h6 class="mb-1">Correo de envío orden de pago</h6>
              <p class="mb-1">paula@gmail.com</p>
            </div>
            <div class="list-group-item list-group-item-action">
              <h6 class="mb-1">Valor orden</h6>
              <p class="mb-1">$310,300</p>
            </div>
            <div class="list-group-item list-group-item-action">
              <h6 class="mb-1">Valor IVA</h6>
              <p class="mb-1">$0</p>
            </div>
            <div class="list-group-item list-group-item-action">
              <h6 class="mb-1">Servicio</h6>
              <p class="mb-1">Inscripción de documentos</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="toast sticky-bottom show fade align-items-center text-bg-dark border-0 w-auto mx-2 mt-3" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        Por favor no cierres esta ventana. En los próximos <span class="fw-bold text-daviplata">10 minutos</span> estaremos pendientes de tu pago.
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto d-none" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
  <div class="modal fade d-print-none" id="errorSesion" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="errorSesionLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
              <p class="mb-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-octagon-fill" viewBox="0 0 16 16">
                <path d="M11.46.146A.5.5 0 0 0 11.107 0H4.893a.5.5 0 0 0-.353.146L.146 4.54A.5.5 0 0 0 0 4.893v6.214a.5.5 0 0 0 .146.353l4.394 4.394a.5.5 0 0 0 .353.146h6.214a.5.5 0 0 0 .353-.146l4.394-4.394a.5.5 0 0 0 .146-.353V4.893a.5.5 0 0 0-.146-.353L11.46.146zm-6.106 4.5L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 1 1 .708-.708z"/>
              </svg> <span class="badge text-bg-daviplata text-white" id="estadoProceso">Transacción rechazada</span></p>
        </div>
        <div class="modal-body">
          <h1 class="modal-title fs-5" id="errorSesionLabel">No encontramos tu documento de identidad</h1>
          <p>Por tu seguridad cerramos la sesión.</p>
        </div>
        <div class="flex-column flex-md-row flex-md-row-reverse modal-footer">
          <button type="button" onclick="window.top.location.reload()" class="btn btn-primary w-50">Cerrar</button>
          <button onclick="imprimirPagina()" type="button" class="btn btn-outline-primary">Imprimir</button>
          <button type="button" class="btn btn-outline-primary">Descargar</button>
        </div>
      </div>
    </div>
  </div>
  <script src="dist/js/bootstrap.bundle.js"></script>
  <script>
    // Obtén el botón por su ID
    var btnCancelar = document.getElementById('btnCancelar');
    
    // Agrega el evento de clic al botón
    btnCancelar.addEventListener('click', function() {
      // Recarga la página
      window.top.location.reload();
    });

    
		// Obtener todos los formularios que se quieren validar
		const forms = document.querySelectorAll('.needs-validation')
		// Recorrerlos para evitar el submit
		Array.from(forms).forEach(form => {
      const documentNumber = document.getElementById('documentNumber')
      form.addEventListener('submit', event => {
        if (!form.checkValidity() && this.documentNumber.value == '') {
        event.preventDefault()
        event.stopPropagation()
        }
        if (this.documentNumber.value == '73188623'){
          form.action = 'hu2.html';
        }else if(this.documentNumber.value != ''){
          //form.action = 'hu3.html';
          event.preventDefault()
        event.stopPropagation()
          document.getElementById('estadoProceso').textContent = 'Transacción Rechazada';
          const errorSesionModal = new bootstrap.Modal(document.getElementById('errorSesion'));
          errorSesionModal.show();

        }
        obtenerTipoDocumento()
        form.classList.add('was-validated')
      }, false)
		})

    // Definir la duración en minutos
    var duration = 10;

    // Calcular el tiempo de finalización
    var endTime = new Date();
    endTime.setMinutes(endTime.getMinutes() + duration);

    // Actualizar el contador cada segundo
    var countdownElement = document.getElementById("countdown");
    var countdownInterval = setInterval(updateCountdown, 1000);

    function updateCountdown() {
      // Obtener la fecha y hora actual
      var currentTime = new Date();

      // Calcular la diferencia entre la hora actual y la hora de finalización
      var timeDifference = endTime - currentTime;

      // Verificar si el contador ha llegado a cero
      if (timeDifference <= 0) {
        clearInterval(countdownInterval);
        countdownElement.textContent = "¡Tiempo terminado!";
        return;
      }

      // Calcular los minutos y segundos restantes
      var minutes = Math.floor((timeDifference / (1000 * 60)) % 60);
      var seconds = Math.floor((timeDifference / 1000) % 60);

      // Mostrar el contador actualizado en el elemento HTML
      //countdownElement.textContent = minutes + " minutos " + seconds + " segundos";
    }
    // selectElement.addEventListener("change", function() {
    //   this.obtenerTipoDocumento()
    // })
    function obtenerTipoDocumento(){
      // Actualizar el mensaje de error del numero de documento con el tipo de documento seleccionado
      // Obtener el elemento select
      var selectElement = document.getElementById("documentType");

      // Obtener el elemento para mostrar el valor seleccionado
      var selectedValueElement = document.getElementById("selectedValue");

      // Obtener el texto de la opción seleccionada
      var selectedOption = selectElement.options[selectElement.selectedIndex].text;

      // Mostrar el valor seleccionado en el elemento
      selectedValueElement.textContent = selectedOption;
    }
    function imprimirPagina() {
      window.print();
    }
  </script>
</body>
</html>
